<!-- Подключение jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Подключение Bootstrap (CSS и JavaScript) -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<div class="main_menu">
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand logo_h" href="@Url.Action("Index", "Home")"><img src="~/img/logo.png" alt=""></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
                <ul class="nav navbar-nav menu_nav ml-auto mr-auto">
                    <li class="nav-item active"><a class="nav-link" href="@Url.Action("Index", "Home")">Home</a></li>
                    <li class="nav-item submenu dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                           aria-expanded="false">Shop</a>
                        <ul class="dropdown-menu">
                            <li class="nav-item"><a class="nav-link" href="@Url.Action("Category", "Product")">Shop Category</a></li>
                            <li class="nav-item"><a class="nav-link" href="@Url.Action("cart", "Product")">Shopping Cart</a></li>
                        </ul>
                    </li>
                    <li class="nav-item submenu dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                           aria-expanded="false">Blog</a>
                        <ul class="dropdown-menu">
                            <li class="nav-item"><a class="nav-link" href="@Url.Action("blog", "Home")">Blog</a></li>
                            <li class="nav-item"><a class="nav-link" href="@Url.Action("SingleBlog", "Home")">Blog Details</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Contact", "Support")">Contact</a></li>
                    <li class="nav-item submenu dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                            <img src="~/img/user.png" alt="User" class="user-icon" />
                        </a>
                        <ul class="dropdown-menu">
                            @{

                                bool permission = ((string)Session["Permission"] == "Admin");
                                bool isUserLoggedIn = ((string)Session["LoginStatus"] == "login");
                            }

                            @if (isUserLoggedIn)
                            {
                                <li class="nav-item"><a class="nav-link" href="@Url.Action("UProfile", "Account")">Profile</a></li>
                                <li class="nav-item"><a class="nav-link" href="@Url.Action("Logout", "Account")">Logout</a></li>
                                <li class="nav-item"><a class="nav-link" href="@Url.Action("Cart", "Product")">Купленные продукты</a></li>
                                if (permission)
                                {
                                    <li class="nav-item"><a class="nav-link" href="@Url.Action("ProductsAdminPanel", "Product")">Admin Panel</a></li>
                                    <li class="nav-item"><a class="nav-link" href="@Url.Action("ViewPort", "Support")">ViewPorts</a></li>
                                }
                            }
                            else
                            {
                                <li class="nav-item"><a class="nav-link" href="@Url.Action("Login", "Account")">Login</a></li>
                                <li class="nav-item"><a class="nav-link" href="@Url.Action("Register", "Account")">Register</a></li>
                            }


                        </ul>
                    </li>
                </ul>

                <ul class="nav-shop">
                    <li class="nav-item">
                        <!-- Контейнер для поля ввода текста и иконки поиска -->
                        <div class="search-input-container">
                            <input type="text" class="form-control searchInput" placeholder="Enter search term...">
                            <i id="searchButton" class="ti-search"></i>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a href="@Url.Action("OrderConfirm", "Product")" class="nav-link">
                            <button class="btn btn-link">
                                <i class="ti-shopping-cart"></i>
                                <span class="nav-shop__circle">3</span>
                            </button>
                        </a>
                    </li>
                </ul>




                <!-- Модальное окно для отображения результатов поиска -->
                <div class="modal" id="searchResultsModal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Search Results</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <ul id="searchResultsList">
                                    <!-- Здесь будут отображаться результаты поиска -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    $(document).ready(function () {
                        $('.searchInput').on('input', function () {
                            var searchTerm = $(this).val().trim();

                            if (searchTerm.length === 0) {
                                $('#searchResultsList').empty();
                                $('#searchResultsModal').modal('hide'); // Скрыть модальное окно при пустом запросе
                                return;
                            }

                            $.ajax({
                                type: 'POST',
                                url: '/Product/SearchProducts',
                                data: { searchTerm: searchTerm },
                                success: function (response) {
                                    displaySearchResults(response.ProductsV2); // Передаем массив ProductsV2 из ответа
                                },
                                error: function (xhr, status, error) {
                                    console.error(error);
                                    alert('Error occurred while searching.');
                                }
                            });
                        });

                        function displaySearchResults(results) {
                            var $list = $('#searchResultsList');
                            $list.empty();

                            if (results && results.length > 0) {
                                results.forEach(function (product) {
                                    // Create product container with data-id attribute for product ID
                                    var $itemContainer = $('<div class="product-container"></div>');
                                    var $productLink = $('<a href="#" class="product-link"></a>');
                                    $productLink.attr('data-id', product.Id); // Assign product ID to data-id attribute
                                    $itemContainer.append($productLink);

                                    // Add product image to the link
                                    var $img = $('<img class="product-image">');
                                    $img.attr('src', product.ImageUrl);
                                    $productLink.append($img);

                                    // Create block for product name and price
                                    var $infoContainer = $('<div class="product-info"></div>');
                                    var $name = $('<p class="product-name"></p>').text(product.Name);
                                    var $price = $('<p class="product-price"></p>').text('Price: ' + product.Price);

                                    // Append name and price to info container
                                    $infoContainer.append($name, $price);

                                    // Append info container to product link
                                    $productLink.append($infoContainer);

                                    // Append product container to search results list
                                    $list.append($itemContainer);
                                });
                            } else {
                                // If no results found
                                $list.append('<li>No results found</li>');
                            }

                            // Show modal with search results
                            $('#searchResultsModal').modal('show');
                        }

                        // Redirect to product details page when clicking on a product link
                        $(document).on('click', '.product-link', function (e) {
                            e.preventDefault(); // Prevent default link behavior (page navigation)

                            // Получаем идентификатор продукта из атрибута data-id
                            var productId = $(this).data('id');

                            if (productId) {
                                // Формируем URL для перехода на страницу SingleProduct с указанием productId в качестве параметра
                                var url = '/Product/SingleProduct/' + productId;

                                // Перенаправляем на новый URL
                                window.location.href = url;
                            } else {
                                console.error('Product ID not found.');
                            }
                        });
                    });
                </script>



                <style>
                    #searchResultsModal .modal-dialog {
                        max-width: 200px; /* Измените эту ширину на желаемую */
                    }
                    /* Стили для контейнера с полем ввода */
                    .search-input-container {
                        position: relative;
                        display: inline-block;
                    }

                    /* Стили для поля ввода */
                    #searchInput {
                        width: 200px; /* Ширина поля ввода */
                        padding: 8px 30px 8px 10px; /* Отступы внутри поля ввода */
                        border: 1px solid #ccc;
                        border-radius: 4px;
                        outline: none;
                        transition: border-color 0.3s ease;
                    }

                    /* Стили для иконки поиска */
                    #searchButton {
                        position: absolute;
                        top: 50%;
                        right: 10px;
                        transform: translateY(-50%);
                        color: #aaa;
                        cursor: pointer;
                    }

                    .product-container {
                        display: flex;
                        align-items: center;
                        margin-bottom: 20px;
                    }

                    .product-image {
                        width: 130px; /* Ширина изображения */
                        height: auto; /* Автоматическая высота для сохранения пропорций */
                        margin-right: 20px; /* Отступ справа от изображения */
                    }

                    .product-info {
                        flex-grow: 1; /* Растягиваем блок с информацией о товаре */
                    }

                    .product-name {
                        font-size: 15px; /* Размер шрифта для названия товара */
                        font-weight: bold; /* Жирное начертание для названия товара */
                    }

                    .product-price {
                        font-size: 15px; /* Размер шрифта для цены */
                        color: #888; /* Цвет текста для цены (серый) */
                    }
                </style>
